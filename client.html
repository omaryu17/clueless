<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Clueless</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
        <style>
            body, html {
                margin: 0;
                padding: 0;
                height: 100%;
                font-family: "Kanit", sans-serif;
                font-weight: 400;
                font-style: normal;
                color: white;
                background-color: #202D1B;
            }
            .container {
                display: flex;
                height: 100%;
            }
            .input-section {
                width: 30%;
                padding: 20px;
                background-color: #472318;
                overflow-y: auto;
            }
            .board-section {
                width: 70%;
                height: 100%;
            }
            input {
                width: 100%;
                padding: 10px;
                margin-bottom: 10px;
                box-sizing: border-box;
                background-color: white; 
                font-family: "Kanit", sans-serif;
                font-weight: 400;
                font-style: normal;
            }
            button {
                width: 100%;
                padding: 10px;
                margin-bottom: 10px;
                box-sizing: border-box;
                background-color: #C26571; /* btn color */
                color: white; /* txt col*/
                border: none; 
                cursor: pointer; /* cursor to pointer on hover */
                font-family: "Kanit", sans-serif;
                font-weight: 400;
                font-style: normal;
            }
            button:hover {
                opacity: 0.8; 
                background-color: #ffb3bc; 
                color: black;
            }
            #messages {
                height: 200px;
                overflow-y: auto;
                border: 1px solid #ccc;
                padding: 10px;
                margin-bottom: 10px;
                background-color: antiquewhite;
                color: #5c3030;
                /* display: flex; */
                /* flex-direction: column-reverse; */
                scroll-behavior: smooth;
                position: sticky;
                scroll-snap-align: end;
                /* scroll-snap-type: mandatory; */
            }
            
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <h1>Game Client</h1>
            <div id="messages">
            </div>
            <div id="createGame">
                <input type="number" id="numPlayersInput" placeholder="Number of Players">
                <input type="text" id="statusInput" placeholder="Game Status">
                <button onclick="createGame()">Create Game</button>
                <input type="number" id="gameIdInput" placeholder="Game ID">
                <button onclick="getGame()">Load Game</button>
            </div>
            
            <select id="moves">
                <option value="">Select a move</option>
                <option value="suggestion">Make a Suggestion</option>
                <option value="accusation">Make a Accusation</option>
                <option value="moveToLocation">Move to a Location</option>
                <option value="showCards">Show Cards</option>
                <option value="secPass">Use Secret Passage</option>
                <option value="endTurn">End Turn</option>
            </select>
            <button onclick="chooseMove()">Choose Move</button>

            <div id="accusationSection" style="display: none;">
                <h3>Make an Accusation</h3>
                <select id="accusationCharacter">
                    <option value="">Select Character</option>
                    <option value="scarlet">Miss Scarlet</option>
                    <option value="mustard">Colonel Mustard</option>
                    <option value="white">Mrs. White</option>
                    <option value="green">Mr. Green</option>
                    <option value="peacock">Mrs. Peacock</option>
                    <option value="plum">Professor Plum</option>
                </select>
                <select id="accusationWeapon">
                    <option value="">Select Weapon</option>
                    <option value="candlestick">Candlestick</option>
                    <option value="dagger">Dagger</option>
                    <option value="leadPipe">Lead Pipe</option>
                    <option value="revolver">Revolver</option>
                    <option value="rope">Rope</option>
                    <option value="wrench">Wrench</option>
                </select>
                <select id="accusationRoom">
                    <option value="">Select Room</option>
                    <option value="0">Study</option>
                    <option value="2">Hall</option>
                    <option value="4">Lounge</option>
                    <option value="8">Library</option>
                    <option value="10">Billiard Room</option>
                    <option value="12">Dining Room</option>
                    <option value="16">Conservatory</option>
                    <option value="18">Ballroom</option>
                    <option value="20">Kitchen</option>
                </select>
                <button onclick="makeAccusation()">Submit Accusation</button>
            </div>

            <div id="roomSelec" style="display: none;">
                <select id="roomDropdown">
                <option value="">Select a room</option>
                <option value="0">Study</option>
                <option value="1">Study to Hall</option>
                <option value="2">Hall</option>
                <option value="3">Hall to Lounge</option>
                <option value="4">Lounge</option>
                <option value="5">Study to Library</option>
                <option value="6">Hall to Billiard</option>
                <option value="7">Lounge to Dining</option>
                <option value="8">Library</option>
                <option value="9">Library to Billiard</option>
                <option value="10">Billiard Room</option>
                <option value="11">Billiard to Dining</option>
                <option value="12">Dining Room</option>
                <option value="13">Library to Conservatory</option>
                <option value="14">Billiard to Ballroom</option>
                <option value="15">Dining to Kitchen</option>
                <option value="16">Conservatory</option>
                <option value="17">Conservatory to Ballroom</option>
                <option value="18">Ballroom</option>
                <option value="19">Ballroom to Kitchen</option>
                <option value="20">Kitchen</option>
            </select>
            <button onclick="moveToLocation()">Move to Room</button>
            </div>

            <input type="text" id="messageInput" placeholder="Type a message...">
            <button onclick="sendMessage()">Send Message</button>

            <button onclick="sendReadyMessage()">Send Ready</button>
            <button onclick="sendActionMessage()">Send Action</button>

            <div id="enterHallway" style="display: none;">
                <input type="number" id="hallwayInput" placeholder="Enter hallway number">
                <button onclick="moveToHallway()">Move to Hallway</button>
            </div>
            <input type="number" id="hallwaygame" placeholder="Enter game" style="display: none;">
            
            <input type="number" id="gethallwaygame" placeholder="Enter game">
            <button onclick="getCurrentHallway()">Get Current Hallway</button>
        </div>
        <div class="board-section">
            <iframe id="gameBoard" src="board.html" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        let inGame = false;

        // connect to server
        const socket = io.connect("http://127.0.0.1:5000");

        let mySocketId = null;
        socket.on('connect', function(){
            mySocketId = socket.id;
        });

        // listen for server messages and display them
        socket.on("server_broadcast", function(data) {
            const messageDiv = document.getElementById("messages");
            messageDiv.innerHTML += "<p>" + data.response + "</p>";
        });

        // send message to server, which gets broadcasted to all clients
        function sendMessage() {
            const messageInput = document.getElementById("messageInput").value;
            socket.emit("client_message", { message: messageInput });
            document.getElementById("messageInput").value = "";
        }

        // // Send move to hallway event
        function moveToHallway() {
            const hallway = document.getElementById('hallwayInput').value;
            const game = document.getElementyByID("hallwaygame").value;
            socket.emit('move_to_hallway', { hallway: hallway, game_id : game});
        }

        // // Request current hallway from the server
        function getCurrentHallway() {
            const game = document.getElementyByID("gethallwaygame").value;
            socket.emit('get_current_hallway', {game_id : game});
        }
        // Request current hallway from the server
        function getCurrentHallway() {
            const game = document.getElementyByID("gethallwaygame").value;
            socket.emit('get_current_hallway', {game_id : game});
        }

        function sendReadyMessage() {
            socket.emit("client_ready", {message: "Player is ready"});
        }

        function sendActionMessage() {
            socket.emit("client_action", {message: "Player pressed action button"})
        }

        // Listen for game creation broadcast
        socket.on('game_created', function(data) {
            const messageDiv = document.getElementById('messages');
            // CreatorID=${data.creator_id}
            messageDiv.innerHTML += `<p>Game Created: ID= ${data.id}, Num Players= ${data.num_players}, Status= ${data.status}</p>`;
            hideCreateGame();
        });

        // Listen for game loaded broadcast
        socket.on('game_loaded', function(data) {
            const messageDiv = document.getElementById('messages');
            messageDiv.innerHTML += `<p>Game Loaded: ID= ${data.id}, Num Players= ${data.num_players}, Status= ${data.status}</p>`;
            hideCreateGame();
        });

        // Listen for game loaded broadcast
        socket.on('game_loaded_error', function(data) {
            const messageDiv = document.getElementById('messages');
            messageDiv.innerHTML += `<p>Game with ID= ${data.id} could not be loaded</p>`;
        });

        // Listen for game loaded broadcast
        socket.on('game_loaded_error', function(data) {
            const messageDiv = document.getElementById('messages');
            messageDiv.innerHTML += `<p>Game with ID= ${data.id} could not be loaded</p>`;
        });

        // Send create_game event to server
        function createGame() {
            const numPlayers = document.getElementById('numPlayersInput').value;
            const status = document.getElementById('statusInput').value;
            socket.emit('create_game', { num_players: numPlayers, status: status });
            document.getElementById("numPlayersInput").value = "";
            document.getElementById("statusInput").value = "";
            // hideCreateGame();
        }

        // Send get_game event to server
        function getGame() {
            const gameId = document.getElementById('gameIdInput').value;
            socket.emit('get_game', { game_id: gameId });
            document.getElementById("gameIdInput").value = "";
            // hideCreateGame();
        }
        // Once the game is created - the create game & status buttons are not shown 
        function hideCreateGame(){
            document.getElementById("numPlayersInput").style.display = 'none';
            document.getElementById("statusInput").style.display = 'none';
            document.getElementById("gameIdInput").style.display = 'none';
            document.querySelector('button[onclick="createGame()"]').style.display = 'none';
            document.querySelector('button[onclick="getGame()"]').style.display = 'none';
        }
        // lists the valid moves for user
        function chooseMove(){
            const move = document.getElementById('moves').value;
            if(!move){
                alert('!!! Please make a move !!!');
                return;
            }
            switch(move){
                case 'suggestion':
                    socket.emit('make_suggestion', {/*tbd*/});
                    break;
                case 'accusation':
                    document.getElementById('accusationSection').style.display = 'block';
                    socket.emit('make_accusation', {/*tbd*/});
                    break;
                case 'moveToLocation':
                    document.getElementById('roomSelec').style.display = 'block';
                    const room = document.getElementById('roomDropdown').value;
                    if(!room){
                        alert('!!! Please choose a room !!!');
                        return;
                    }else{
                        alert('chosen room is' + room);
                        // socket.emit('move_room', {room: room});
                        document.getElementById('roomDropdown').value = '';
                        document.getElementById('roomSelec').style.display = 'none';
                        return;
                    }
                    break;
                case 'showCards':
                    socket.emit('show_cards', {/*tbd*/});
                    break;
                case 'secPass':
                    socket.emit('sec_pass', {/*tbd*/});
                    break;
                case 'endTurn':
                    socket.emit('end_turn', {/*tbd*/});
                    break;
            }
            document.getElementById('moves').value = '';
        }

        function showAccusationSection() {
            document.getElementById('accusationSection').style.display = 'block';
        }

        function makeAccusation() {
            const character = document.getElementById('accusationCharacter').value;
            const weapon = document.getElementById('accusationWeapon').value;
            const room = document.getElementById('accusationRoom').value;

            if (!character || !weapon || !room) {
                alert('Please select a character, weapon, and room for your accusation.');
                return;
            }

            // Emit accusation to server
            socket.emit('make_accusation', {
                character: character,
                weapon: weapon,
                room: room
            });

            alert(`Accusation made: ${character} did it with the ${weapon} in the ${room}.`);

            // Reset dropdowns after submission
            document.getElementById('accusationCharacter').value = '';
            document.getElementById('accusationWeapon').value = '';
            document.getElementById('accusationRoom').value = '';

            // Hide the accusation section
            document.getElementById('accusationSection').style.display = 'none';
        }

    </script>
</body>
</html>
